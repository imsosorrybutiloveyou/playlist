<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê³µìœ  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</title>
  <style>
    :root{
      --bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03);
      --text:#e6eef6;
    }
    body.light {
      --bg:#f4f6fb;--card:#ffffff;--accent:#7c3aed;--muted:#444;--glass:rgba(0,0,0,0.03);
      --text:#111;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);transition:background 0.3s,color 0.3s}
    header{padding:18px 24px;display:flex;align-items:center;gap:16px;justify-content:space-between}
    h1{margin:0;font-size:18px}
    .container{max-width:1100px;margin:18px auto;padding:18px}
    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px}
    .card{background:var(--card);padding:14px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.2);transition:background 0.3s}
    .small{font-size:13px;color:var(--muted)}
    .auth{display:flex;flex-direction:column;gap:8px}
    .auth input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);background:transparent;color:inherit}
    .btn{display:inline-block;padding:8px 12px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--muted);color:var(--text)}
    .submit-group{display:flex;gap:8px;align-items:center}
    textarea{width:100%;min-height:64px;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(0,0,0,0.1);color:inherit}
    .feed{display:flex;flex-direction:column;gap:12px}
    .post{display:flex;gap:12px;padding:12px;border-radius:12px;background:var(--glass);align-items:flex-start}
    .meta{min-width:120px}
    .title{font-weight:600}
    .desc{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center;margin-top:8px}
    .like,.dislike{padding:6px 8px;border-radius:8px;background:var(--glass);cursor:pointer;border:none}
    .counts{font-size:13px;color:var(--muted);margin-left:6px}
    .comment-box{margin-top:8px}
    .comment-list{margin-top:8px;display:flex;flex-direction:column;gap:6px}
    .comment{padding:8px;border-radius:8px;background:rgba(255,255,255,0.05)}
    .reply-box{margin-top:6px;margin-left:20px}
    .best-list{display:flex;flex-direction:column;gap:8px}
    .best-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:900px){.layout{grid-template-columns:1fr}.meta{min-width:unset}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:16px">
      <h1>ê³µìœ  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h1>
      <div class="small">Spotify / YouTube / SoundCloud / Apple Music ì§€ì›</div>
    </div>
    <button id="theme-toggle" class="btn ghost">ğŸŒ™/â˜€ï¸</button>
  </header>

  <div class="container">
    <div class="layout">
      <aside>
        <div class="card"><div id="user-panel"></div></div>
        <div style="height:12px"></div>
        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">ì‹¤ì‹œê°„ ë² ìŠ¤íŠ¸</div>
          <div id="best" class="best-list small"></div>
        </div>
      </aside>

      <main>
        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì˜¬ë¦¬ê¸°</div>
          <div class="small">í—ˆìš©ë˜ëŠ” URL: Spotify/YouTube/SoundCloud/Apple Music</div>
          <div style="height:8px"></div>
          <div id="submit-area"></div>
        </div>
        <div style="height:12px"></div>
        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">ì „ì²´ ê³µìœ  ëª©ë¡</div>
          <div id="feed" class="feed"></div>
        </div>
      </main>
    </div>
    <footer>âš ï¸ ì´ ì„œë¹„ìŠ¤ëŠ” <b>ë°ëª¨</b>ì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</footer>
  </div>

<script>
const PROVIDER_PATTERNS = [
  {name:'YouTube', pattern:/(?:youtube\.com\/playlist\?list=|youtu\.be\/).*?/i},
  {name:'Spotify', pattern:/(?:open\.spotify\.com\/playlist\/|spotify:playlist:)/i},
  {name:'SoundCloud', pattern:/soundcloud\.com\/.+\/sets\//i},
  {name:'AppleMusic', pattern:/music\.apple\.com\/.+\/playlist\//i}
];
function storage(key,v){if(v===undefined)return JSON.parse(localStorage.getItem(key)||'null');localStorage.setItem(key,JSON.stringify(v));}
if(!storage('ps_users'))storage('ps_users',{});
if(!storage('ps_posts'))storage('ps_posts',[]);
let STATE={user:null};
function escapeHtml(str){return str.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}
function escapeAttr(str){return str.replace(/"/g,'&quot;');}

function renderUserPanel(){
  const el=document.getElementById('user-panel');el.innerHTML='';
  if(STATE.user){
    el.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(STATE.user)}</strong><div class="small">ë¡œê·¸ì¸ ìƒíƒœ</div></div><button id="logout" class="btn ghost">ë¡œê·¸ì•„ì›ƒ</button></div>`;
    document.getElementById('logout').onclick=()=>{STATE.user=null;localStorage.removeItem('ps_session');renderUserPanel();renderSubmitArea();};
  }else{
    el.innerHTML=`<div class="auth">
      <input id="auth-user" placeholder="ì•„ì´ë””" />
      <input id="auth-pass" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password"/>
      <div style="display:flex;gap:8px"><button id="login" class="btn">ë¡œê·¸ì¸</button><button id="signup" class="btn ghost">íšŒì›ê°€ì…</button></div>
      <div class="small">(ë°ëª¨) ë¹„ë°€ë²ˆí˜¸ëŠ” ì•”í˜¸í™” ì—†ì´ ì €ì¥ë©ë‹ˆë‹¤.</div>
    </div>`;
    document.getElementById('signup').onclick=signup;
    document.getElementById('login').onclick=login;
  }
}
function signup(){
  const u=document.getElementById('auth-user').value.trim();
  const p=document.getElementById('auth-pass').value;
  if(!u||!p){alert('ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥');return}
  const users=storage('ps_users')||{};
  if(users[u]){alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””');return}
  users[u]={password:btoa(p)};storage('ps_users',users);
  alert('íšŒì›ê°€ì… ì™„ë£Œ. ë¡œê·¸ì¸í•˜ì„¸ìš”.');
}
function login(){
  const u=document.getElementById('auth-user').value.trim();
  const p=document.getElementById('auth-pass').value;
  const users=storage('ps_users')||{};
  if(!users[u]||users[u].password!==btoa(p)){alert('ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');return}
  STATE.user=u;localStorage.setItem('ps_session',u);
  renderUserPanel();renderSubmitArea();renderFeed();
}
if(localStorage.getItem('ps_session'))STATE.user=localStorage.getItem('ps_session');
renderUserPanel();

function renderSubmitArea(){
  const area=document.getElementById('submit-area');
  if(!STATE.user){area.innerHTML='<div class="small">ì—…ë¡œë“œí•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”.</div>';return}
  area.innerHTML=`<input id="title" placeholder="ì œëª©" /><div style="height:8px"></div>
  <input id="link" placeholder="ë§í¬" /><div style="height:8px"></div>
  <textarea id="description" placeholder="ì„¤ëª…"></textarea><div style="height:8px"></div>
  <div class="submit-group"><button id="post-btn" class="btn">ì—…ë¡œë“œ</button><div class="small" id="post-msg"></div></div>`;
  document.getElementById('post-btn').onclick=handlePost;
}
renderSubmitArea();

function detectProvider(url){try{for(const p of PROVIDER_PATTERNS){if(p.pattern.test(url))return p.name}}catch(e){}return null;}
function handlePost(){
  const title=document.getElementById('title').value.trim();
  const link=document.getElementById('link').value.trim();
  const desc=document.getElementById('description').value.trim();
  const msg=document.getElementById('post-msg');msg.textContent='';
  if(!title||!link){msg.textContent='ì œëª©/ë§í¬ í•„ìš”';return}
  const provider=detectProvider(link);if(!provider){msg.textContent='í—ˆìš©ë˜ì§€ ì•Šì€ ë§í¬';return}
  const posts=storage('ps_posts')||[];
  const id='p_'+Date.now();
  posts.unshift({id,title,link,desc,provider,owner:STATE.user,likes:0,dislikes:0,comments:[]});
  storage('ps_posts',posts);
  document.getElementById('title').value='';document.getElementById('link').value='';document.getElementById('description').value='';
  msg.textContent='ì—…ë¡œë“œ ì™„ë£Œ';renderFeed();renderBest();
}
function toggleLike(id,isLike){
  const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===id);if(!p)return;
  if(isLike)p.likes++;else p.dislikes++;
  storage('ps_posts',posts);renderFeed();renderBest();
}
function addComment(pid,text){
  if(!STATE.user){alert('ë¡œê·¸ì¸ í•„ìš”');return}
  if(!text.trim())return;
  const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===pid);if(!p)return;
  p.comments.push({user:STATE.user,text,replies:[]});
  storage('ps_posts',posts);renderFeed();
}
function addReply(pid,cidx,text){
  if(!STATE.user){alert('ë¡œê·¸ì¸ í•„ìš”');return}
  if(!text.trim())return;
  const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===pid);if(!p)return;
  p.comments[cidx].replies.push({user:STATE.user,text});
  storage('ps_posts',posts);renderFeed();
}
function deletePost(id){
  const posts=storage('ps_posts')||[];
  const idx=posts.findIndex(x=>x.id===id);
  if(idx>-1 && posts[idx].owner===STATE.user){
    if(confirm('ì‚­ì œí• ê¹Œìš”?')){posts.splice(idx,1);storage('ps_posts',posts);renderFeed();renderBest();}
  }
}
function renderFeed(){
  const feed=document.getElementById('feed');feed.innerHTML='';
  const posts=storage('ps_posts')||[];
  if(posts.length===0){feed.innerHTML='<div class=small>ì•„ì§ ê³µìœ  ì—†ìŒ</div>';return}
  for(const post of posts){
    const node=document.createElement('div');node.className='post';
    const meta=document.createElement('div');meta.className='meta';
    meta.innerHTML=`<div class=title>${escapeHtml(post.title)}</div><div class=small>by ${escapeHtml(post.owner)} Â· ${escapeHtml(post.provider)}</div>`;
    const body=document.createElement('div');body.style.flex='1';
    body.innerHTML=`<a href="${escapeAttr(post.link)}" target=_blank>${escapeHtml(post.link)}</a>`;
    if(post.desc){body.innerHTML+=`<div class=small>${escapeHtml(post.desc)}</div>`}
    const actions=document.createElement('div');actions.className='actions';
    const like=document.createElement('button');like.className='like';like.textContent='ğŸ‘';like.onclick=()=>toggleLike(post.id,true);
    const dislike=document.createElement('button');dislike.className='dislike';dislike.textContent='ğŸ‘';dislike.onclick=()=>toggleLike(post.id,false);
    const counts=document.createElement('div');counts.className='counts';counts.textContent=`${post.likes}/${post.dislikes}`;
    actions.append(like,dislike,counts);
    if(STATE.user===post.owner){const del=document.createElement('button');del.className='btn ghost';del.textContent='ì‚­ì œ';del.onclick=()=>deletePost(post.id);actions.append(del);}
    const commentBox=document.createElement('div');commentBox.className='comment-box';
    const ci=document.createElement('input');ci.placeholder='ëŒ“ê¸€ ë‹¬ê¸°...';ci.style.width='70%';
    const cb=document.createElement('button');cb.className='btn ghost';cb.textContent='ëŒ“ê¸€';cb.onclick=()=>{addComment(post.id,ci.value);ci.value=''};
    commentBox.append(ci,cb);
    const cl=document.createElement('div');cl.className='comment-list';
    post.comments.forEach((c,idx)=>{
      const cnode=document.createElement('div');cnode.className='comment small';
      cnode.innerHTML=`<strong>${escapeHtml(c.user)}</strong> ${escapeHtml(c.text)}`;
      if(STATE.user){
        const rb=document.createElement('div');rb.className='reply-box';
        const ri=document.createElement('input');ri.placeholder='ëŒ€ëŒ“ê¸€...';ri.style.width='70%';
        const rbtn=document.createElement('button');rbtn.className='btn ghost';rbtn.textContent='â†©';rbtn.onclick=()=>{addReply(post.id,idx,ri.value);ri.value=''};
        rb.append(ri,rbtn);cnode.appendChild(rb);
      }
      if(c.replies){c.replies.forEach(r=>{const rn=document.createElement('div');rn.className='small';rn.style.marginLeft='20px';rn.innerHTML=`â†³ <strong>${escapeHtml(r.user)}</strong> ${escapeHtml(r.text)}`;cnode.appendChild(rn);});}
      cl.appendChild(cnode);
    });
    node.append(meta,body,actions,commentBox,cl);
    feed.appendChild(node);
  }
}
function renderBest(){
  const best=document.getElementById('best');best.innerHTML='';
  const posts=storage('ps_posts')||[];
  posts.sort((a,b)=>(b.likes-b.dislikes)-(a.likes-a.dislikes));
  posts.slice(0,5).forEach(p=>{const d=document.createElement('div');d.className='best-item';d.textContent=`${p.title} (${p.likes}ğŸ‘)`;best.appendChild(d);});
}
renderFeed();renderBest();

// í…Œë§ˆ í† ê¸€
const themeBtn=document.getElementById('theme-toggle');
function applyTheme(){document.body.classList.toggle('light',localStorage.getItem('theme')==='light');}
themeBtn.onclick=()=>{const cur=localStorage.getItem('theme')==='light'?'dark':'light';localStorage.setItem('theme',cur);applyTheme();}
applyTheme();
</script>
</body>
</html>
