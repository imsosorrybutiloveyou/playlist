<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŒì•… ì¬ìƒëª©ë¡ ê³µìœ </title>
  <style>
    body{
      font-family:sans-serif;
      margin:0;
      padding:0;
      background:#f5f5f5;
      color:#222;
      transition:background .3s,color .3s;
    }
    header{
      background:#6200ea;
      color:#fff;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header h1{margin:0;font-size:20px;}
    .theme-toggle{cursor:pointer;}
    main{padding:20px;max-width:800px;margin:auto;}
    .card{
      background:#fff;
      border-radius:12px;
      padding:16px;
      margin-bottom:20px;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
      transition:background .3s,color .3s;
    }
    .dark body{background:#111;color:#eee;}
    .dark .card{background:#222;color:#eee;}
    .hidden{display:none;}
    .comment-box, .reply-box{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .comment-box input,.reply-box input{
      width:100%;
      padding:6px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.2);
      background:transparent;
      color:inherit;
    }
    .comment-box button,.reply-box button{
      align-self:flex-end;
      padding:6px 12px;
      border:none;
      border-radius:6px;
      background:#6200ea;
      color:#fff;
      cursor:pointer;
    }
    .reply{margin-left:20px;margin-top:6px;}
    .delete-btn{
      background:#e53935;color:#fff;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;float:right;
    }
  </style>
</head>
<body>
  <header>
    <h1>ìŒì•… ì¬ìƒëª©ë¡ ê³µìœ </h1>
    <div>
      <button id="themeToggle" class="theme-toggle">ğŸŒ™</button>
      <button id="logoutBtn" class="hidden">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>
  <main>
    <!-- ë¡œê·¸ì¸ / íšŒì›ê°€ì… -->
    <div id="authBox" class="card">
      <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
      <input id="username" placeholder="ì•„ì´ë””">
      <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
      <button id="loginBtn">ë¡œê·¸ì¸</button>
      <button id="signupBtn">íšŒì›ê°€ì…</button>
    </div>

    <!-- ì—…ë¡œë“œ -->
    <div id="uploadBox" class="card hidden">
      <h2>ì¬ìƒëª©ë¡ ì˜¬ë¦¬ê¸°</h2>
      <input id="plTitle" placeholder="ì œëª©">
      <input id="plLink" placeholder="ì¬ìƒëª©ë¡ ë§í¬">
      <textarea id="plDesc" placeholder="ì„¤ëª…" style="width:100%;margin-top:8px;"></textarea>
      <button id="uploadBtn">ì˜¬ë¦¬ê¸°</button>
    </div>

    <!-- ë² ìŠ¤íŠ¸ -->
    <div id="bestBox" class="card hidden">
      <h2>ì‹¤ì‹œê°„ ë² ìŠ¤íŠ¸</h2>
      <ul id="bestList"></ul>
    </div>

    <!-- ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ -->
    <div id="feed"></div>
  </main>

<script>
const state={user:null,playlists:[]};

// GitHub ì €ì¥ì†Œ ì„¤ì • (ìƒ˜í”Œ)
const GITHUB_USER="YOUR_GITHUB_USERNAME";
const GITHUB_REPO="YOUR_REPO";
const GITHUB_FILE="playlist-data.json";
const GITHUB_TOKEN="YOUR_PERSONAL_ACCESS_TOKEN"; // ì‹¤ì œ ì‚¬ìš©ì‹œ ë…¸ì¶œ ê¸ˆì§€

async function loadData(){
  try{
    const res=await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/${GITHUB_FILE}`);
    if(res.ok){state.playlists=await res.json();render();}
  }catch(e){console.log(e);}
}

async function saveData(){
  // GitHub APIë¡œ JSON push (ë³´ì•ˆìƒ ì„œë²„less í•¨ìˆ˜ë¡œ ì¤‘ê³„í•˜ëŠ” ê²Œ ê¶Œì¥)
  const getRes=await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${GITHUB_FILE}`,{
    headers:{Authorization:`token ${GITHUB_TOKEN}`}
  });
  const fileInfo=await getRes.json();
  const content=btoa(unescape(encodeURIComponent(JSON.stringify(state.playlists,null,2))));
  await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${GITHUB_FILE}`,{
    method:"PUT",
    headers:{"Content-Type":"application/json",Authorization:`token ${GITHUB_TOKEN}`},
    body:JSON.stringify({message:"update playlists",content:content,sha:fileInfo.sha})
  });
}

function render(){
  document.getElementById("feed").innerHTML="";
  state.playlists.forEach((pl,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h3>${pl.title}<button class='delete-btn' data-i='${i}'>ì‚­ì œ</button></h3>
    <a href='${pl.link}' target='_blank'>ë§í¬</a><p>${pl.desc||""}</p>
    <div>ğŸ‘ ${pl.likes||0} ğŸ‘ ${pl.dislikes||0}</div>
    <div class='comment-list'></div>
    <div class='comment-box'>
      <input placeholder='ëŒ“ê¸€ ì‘ì„±'>
      <button>ëŒ“ê¸€ ë‹¬ê¸°</button>
    </div>`;
    document.getElementById("feed").appendChild(card);
  });
}

// ë¡œê·¸ì¸/íšŒì›ê°€ì…
const authBox=document.getElementById("authBox");
const uploadBox=document.getElementById("uploadBox");
const bestBox=document.getElementById("bestBox");
const logoutBtn=document.getElementById("logoutBtn");

document.getElementById("signupBtn").onclick=()=>{
  localStorage.setItem("user",document.getElementById("username").value);
  state.user=document.getElementById("username").value;
  authBox.classList.add("hidden");uploadBox.classList.remove("hidden");bestBox.classList.remove("hidden");logoutBtn.classList.remove("hidden");
};

document.getElementById("loginBtn").onclick=()=>{
  state.user=document.getElementById("username").value;
  authBox.classList.add("hidden");uploadBox.classList.remove("hidden");bestBox.classList.remove("hidden");logoutBtn.classList.remove("hidden");
};

logoutBtn.onclick=()=>{state.user=null;localStorage.removeItem("user");location.reload();}

// ì—…ë¡œë“œ
 document.getElementById("uploadBtn").onclick=()=>{
  const t=document.getElementById("plTitle").value;
  const l=document.getElementById("plLink").value;
  const d=document.getElementById("plDesc").value;
  state.playlists.push({title:t,link:l,desc:d,author:state.user,likes:0,dislikes:0,comments:[]});
  saveData();render();
};

// í…Œë§ˆ í† ê¸€
document.getElementById("themeToggle").onclick=()=>{
  document.body.classList.toggle("dark");
};

loadData();
</script>
</body>
</html>
