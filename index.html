<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>음악 재생목록 공유</title>
  <style>
    body{
      font-family:sans-serif;
      margin:0;
      padding:0;
      background:#f5f5f5;
      color:#222;
      transition:background .3s,color .3s;
    }
    header{
      background:#6200ea;
      color:#fff;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header h1{margin:0;font-size:20px;}
    .theme-toggle{cursor:pointer;}
    main{padding:20px;max-width:800px;margin:auto;}
    .card{
      background:#fff;
      border-radius:12px;
      padding:16px;
      margin-bottom:20px;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
      transition:background .3s,color .3s;
    }
    .dark body{background:#111;color:#eee;}
    .dark .card{background:#222;color:#eee;}
    .hidden{display:none;}
    .comment-box, .reply-box{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .comment-box input,.reply-box input{
      width:100%;
      padding:6px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.2);
      background:transparent;
      color:inherit;
    }
    .comment-box button,.reply-box button{
      align-self:flex-end;
      padding:6px 12px;
      border:none;
      border-radius:6px;
      background:#6200ea;
      color:#fff;
      cursor:pointer;
    }
    .reply{margin-left:20px;margin-top:6px;}
    .delete-btn{
      background:#e53935;color:#fff;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;float:right;
    }
  </style>
</head>
<body>
  <header>
    <h1>음악 재생목록 공유</h1>
    <div>
      <button id="themeToggle" class="theme-toggle">🌙</button>
      <button id="logoutBtn" class="hidden">로그아웃</button>
    </div>
  </header>
  <main>
    <!-- 로그인 / 회원가입 -->
    <div id="authBox" class="card">
      <h2>로그인 / 회원가입</h2>
      <input id="username" placeholder="아이디">
      <input id="password" type="password" placeholder="비밀번호">
      <button id="loginBtn">로그인</button>
      <button id="signupBtn">회원가입</button>
    </div>

    <!-- 업로드 -->
    <div id="uploadBox" class="card hidden">
      <h2>재생목록 올리기</h2>
      <input id="plTitle" placeholder="제목">
      <input id="plLink" placeholder="재생목록 링크">
      <textarea id="plDesc" placeholder="설명" style="width:100%;margin-top:8px;"></textarea>
      <button id="uploadBtn">올리기</button>
    </div>

    <!-- 베스트 -->
    <div id="bestBox" class="card hidden">
      <h2>실시간 베스트</h2>
      <ul id="bestList"></ul>
    </div>

    <!-- 게시물 리스트 -->
    <div id="feed"></div>
  </main>

<script>
const state={user:null,playlists:[]};

// GitHub 저장소 설정 (샘플)
const GITHUB_USER="YOUR_GITHUB_USERNAME";
const GITHUB_REPO="YOUR_REPO";
const GITHUB_FILE="playlist-data.json";
const GITHUB_TOKEN="YOUR_PERSONAL_ACCESS_TOKEN"; // 실제 사용시 노출 금지

async function loadData(){
  try{
    const res=await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/${GITHUB_FILE}`);
    if(res.ok){state.playlists=await res.json();render();}
  }catch(e){console.log(e);}
}

async function saveData(){
  // GitHub API로 JSON push (보안상 서버less 함수로 중계하는 게 권장)
  const getRes=await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${GITHUB_FILE}`,{
    headers:{Authorization:`token ${GITHUB_TOKEN}`}
  });
  const fileInfo=await getRes.json();
  const content=btoa(unescape(encodeURIComponent(JSON.stringify(state.playlists,null,2))));
  await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${GITHUB_FILE}`,{
    method:"PUT",
    headers:{"Content-Type":"application/json",Authorization:`token ${GITHUB_TOKEN}`},
    body:JSON.stringify({message:"update playlists",content:content,sha:fileInfo.sha})
  });
}

function render(){
  document.getElementById("feed").innerHTML="";
  state.playlists.forEach((pl,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h3>${pl.title}<button class='delete-btn' data-i='${i}'>삭제</button></h3>
    <a href='${pl.link}' target='_blank'>링크</a><p>${pl.desc||""}</p>
    <div>👍 ${pl.likes||0} 👎 ${pl.dislikes||0}</div>
    <div class='comment-list'></div>
    <div class='comment-box'>
      <input placeholder='댓글 작성'>
      <button>댓글 달기</button>
    </div>`;
    document.getElementById("feed").appendChild(card);
  });
}

// 로그인/회원가입
const authBox=document.getElementById("authBox");
const uploadBox=document.getElementById("uploadBox");
const bestBox=document.getElementById("bestBox");
const logoutBtn=document.getElementById("logoutBtn");

document.getElementById("signupBtn").onclick=()=>{
  localStorage.setItem("user",document.getElementById("username").value);
  state.user=document.getElementById("username").value;
  authBox.classList.add("hidden");uploadBox.classList.remove("hidden");bestBox.classList.remove("hidden");logoutBtn.classList.remove("hidden");
};

document.getElementById("loginBtn").onclick=()=>{
  state.user=document.getElementById("username").value;
  authBox.classList.add("hidden");uploadBox.classList.remove("hidden");bestBox.classList.remove("hidden");logoutBtn.classList.remove("hidden");
};

logoutBtn.onclick=()=>{state.user=null;localStorage.removeItem("user");location.reload();}

// 업로드
 document.getElementById("uploadBtn").onclick=()=>{
  const t=document.getElementById("plTitle").value;
  const l=document.getElementById("plLink").value;
  const d=document.getElementById("plDesc").value;
  state.playlists.push({title:t,link:l,desc:d,author:state.user,likes:0,dislikes:0,comments:[]});
  saveData();render();
};

// 테마 토글
document.getElementById("themeToggle").onclick=()=>{
  document.body.classList.toggle("dark");
};

loadData();
</script>
</body>
</html>
