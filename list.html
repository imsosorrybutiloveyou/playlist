<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>공유 플레이리스트 사이트 (데모)</title>
  <style>
    :root{
      --bg-dark:#0f1724;--card-dark:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03);
      --bg-light:#f5f7fa;--card-light:#ffffff;--text-light:#111827;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{margin:0;min-height:100vh;background:var(--bg-dark);color:#e6eef6;transition:background 0.3s,color 0.3s}
    body.light{background:var(--bg-light);color:var(--text-light)}
    header{padding:18px 24px;display:flex;align-items:center;gap:16px;justify-content:space-between}
    h1{margin:0;font-size:18px}
    .container{max-width:1100px;margin:18px auto;padding:18px}
    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px}

    /* card */
    .card{background:var(--card-dark);padding:14px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.6);transition:background 0.3s}
    body.light .card{background:var(--card-light);box-shadow:0 4px 10px rgba(0,0,0,0.1)}
    .small{font-size:13px;color:var(--muted)}

    /* auth */
    .auth{display:flex;flex-direction:column;gap:8px}
    .auth input, .auth textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);background:transparent;color:inherit}
    .btn{display:inline-block;padding:8px 10px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.1);color:inherit}

    /* submit */
    .submit-group{display:flex;gap:8px;align-items:center}
    textarea{width:100%;min-height:64px;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(0,0,0,0.1);color:inherit}

    /* feed */
    .feed{display:flex;flex-direction:column;gap:12px}
    .post{display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));align-items:flex-start}
    body.light .post{background:#f9fafb}
    .meta{font-weight:600}
    .desc{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center;margin-top:8px}
    .like, .dislike{padding:6px 8px;border-radius:8px;background:var(--glass);cursor:pointer;border:none}
    .counts{font-size:13px;color:var(--muted);margin-left:6px}
    .comment-box{margin-top:8px}
    .comment-list{margin-top:8px;display:flex;flex-direction:column;gap:6px}
    .comment{padding:8px;border-radius:8px;background:rgba(255,255,255,0.05)}
    body.light .comment{background:#eceff1}
    .reply-box{margin-top:6px;margin-left:20px}

    /* best */
    .best-list{display:flex;flex-direction:column;gap:8px}
    .best-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.05)}
    body.light .best-item{background:#f3f4f6}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    @media (max-width:900px){.layout{grid-template-columns:1fr}.meta{min-width:unset}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;gap:16px;align-items:center">
      <h1>공유 플레이리스트 데모</h1>
      <div class="small">링크 검증: Spotify / YouTube Playlist / SoundCloud Sets / Apple Music</div>
    </div>
    <button id="theme-toggle" class="btn ghost">🌙/☀️</button>
  </header>

  <div class="container">
    <div class="layout">
      <aside>
        <div class="card">
          <div id="user-panel"></div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">실시간 베스트</div>
          <div id="best" class="best-list small"></div>
        </div>
      </aside>

      <main>
        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">플레이리스트 올리기</div>
          <div class="small">허용되는 URL 형식만 가능합니다.</div>
          <div style="height:8px"></div>
          <div id="submit-area"></div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">전체 공유 목록</div>
          <div id="feed" class="feed"></div>
        </div>

      </main>
    </div>

    <footer>데모 버전: LocalStorage 사용. 실제 서비스는 서버/DB 필요.</footer>
  </div>

<script>
const PROVIDER_PATTERNS = [
  {name:'YouTube', pattern: /(?:youtube\.com\/playlist\?list=|youtu\.be\/).*?/i},
  {name:'Spotify', pattern: /(?:open\.spotify\.com\/playlist\/|spotify:playlist:)/i},
  {name:'SoundCloud', pattern: /soundcloud\.com\/.+\/sets\//i},
  {name:'AppleMusic', pattern: /music\.apple\.com\/.+\/playlist\//i}
];

function storage(key, v){ if(v===undefined) return JSON.parse(localStorage.getItem(key)||'null'); localStorage.setItem(key, JSON.stringify(v)); }
if(!storage('ps_users')) storage('ps_users', {});
if(!storage('ps_posts')) storage('ps_posts', []);
let STATE = {user:null};

function escapeHtml(str){return str.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}
function escapeAttr(str){return str.replace(/"/g,'&quot;');}

function renderUserPanel(){
  const el=document.getElementById('user-panel'); el.innerHTML='';
  if(STATE.user){
    el.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(STATE.user)}</strong><div class=small>로그인 상태</div></div><button id=logout class="btn ghost">로그아웃</button></div>`;
    document.getElementById('logout').onclick=()=>{STATE.user=null; localStorage.removeItem('ps_session'); renderUserPanel(); renderSubmitArea();};
  }else{
    el.innerHTML=`<div class=auth><input id=auth-user placeholder="아이디" /><input id=auth-pass placeholder="비밀번호" type=password /><div style="display:flex;gap:8px"><button id=login class=btn>로그인</button><button id=signup class="btn ghost">회원가입</button></div><div class=small>(데모) 비밀번호는 브라우저에 저장됩니다.</div></div>`;
    document.getElementById('signup').onclick=signup;
    document.getElementById('login').onclick=login;
  }
}

function signup(){const u=document.getElementById('auth-user').value.trim();const p=document.getElementById('auth-pass').value;const users=storage('ps_users')||{};if(!u||!p)return alert('입력 필요');if(users[u])return alert('이미 존재');users[u]={password:btoa(p)};storage('ps_users',users);alert('회원가입 완료');}
function login(){const u=document.getElementById('auth-user').value.trim();const p=document.getElementById('auth-pass').value;const users=storage('ps_users')||{};if(!users[u]||users[u].password!==btoa(p))return alert('오류');STATE.user=u;localStorage.setItem('ps_session',u);renderUserPanel();renderSubmitArea();renderFeed();}
if(localStorage.getItem('ps_session')) STATE.user=localStorage.getItem('ps_session');
renderUserPanel();

function renderSubmitArea(){const a=document.getElementById('submit-area');if(!STATE.user){a.innerHTML='<div class=small>로그인 필요</div>';return}a.innerHTML=`<input id=title placeholder="제목"/><div style=height:8px></div><input id=link placeholder="링크"/><div style=height:8px></div><textarea id=description placeholder="설명"></textarea><div style=height:8px></div><div class=submit-group><button id=post-btn class=btn>업로드</button><div class=small id=post-msg></div></div>`;document.getElementById('post-btn').onclick=handlePost;}
renderSubmitArea();

function detectProvider(url){try{for(const p of PROVIDER_PATTERNS){if(p.pattern.test(url))return p.name}}catch(e){}return null;}

function handlePost(){const title=document.getElementById('title').value.trim();const link=document.getElementById('link').value.trim();const desc=document.getElementById('description').value.trim();const msg=document.getElementById('post-msg');if(!title||!link)return msg.textContent='필수입력';const prov=detectProvider(link);if(!prov)return msg.textContent='허용 안됨';const posts=storage('ps_posts')||[];const id='p_'+Date.now();posts.unshift({id,title,link,desc,provider:prov,owner:STATE.user,likes:0,dislikes:0,comments:[]});storage('ps_posts',posts);document.getElementById('title').value=document.getElementById('link').value=document.getElementById('description').value='';msg.textContent='업로드 완료';renderFeed();renderBest();}

function toggleLike(id,isLike){const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===id);if(!p)return;if(isLike)p.likes++;else p.dislikes++;storage('ps_posts',posts);renderFeed();renderBest();}

function addComment(pid,text){if(!STATE.user)return alert('로그인 필요');if(!text.trim())return;const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===pid);if(!p)return;p.comments.push({user:STATE.user,text,replies:[]});storage('ps_posts',posts);renderFeed();}
function addReply(pid,cidx,text){if(!STATE.user)return alert('로그인 필요');if(!text.trim())return;const posts=storage('ps_posts')||[];const p=posts.find(x=>x.id===pid);if(!p)return;p.comments[cidx].replies.push({user:STATE.user,text});storage('ps_posts',posts);renderFeed();}
function deletePost(id){const posts=storage('ps_posts')||[];const idx=posts.findIndex(x=>x.id===id);if(idx>-1&&posts[idx].owner===STATE.user){posts.splice(idx,1);storage('ps_posts',posts);renderFeed();renderBest();}}

function renderFeed(){const feed=document.getElementById('feed');feed.innerHTML='';const posts=storage('ps_posts')||[];if(!posts.length)return feed.innerHTML='<div class=small>공유 없음</div>';for(const post of posts){const node=document.createElement('div');node.className='post';
  const meta=document.createElement('div');meta.className='meta';meta.textContent=`${post.title} (by ${post.owner}, ${post.provider})`;
  const body=document.createElement('div');body.innerHTML=`<a href="${escapeAttr(post.link)}" target=_blank>${escapeHtml(post.link)}</a>`+(post.desc?`<div class=small>${escapeHtml(post.desc)}</div>`:'');
  const actions=document.createElement('div');actions.className='actions';
  const like=document.createElement('button');like.className='like';like.textContent='👍';like.onclick=()=>toggleLike(post.id,true);
  const dislike=document.createElement('button');dislike.className='dislike';dislike.textContent='👎';dislike.onclick=()=>toggleLike(post.id,false);
  const counts=document.createElement('div');counts.className='counts';counts.textContent=`${post.likes}/${post.dislikes}`;
  actions.append(like,dislike,counts);
  if(post.owner===STATE.user){const del=document.createElement('button');del.className='btn ghost';del.textContent='삭제';del.onclick=()=>deletePost(post.id);actions.appendChild(del);}

  const cl=document.createElement('div');cl.className='comment-list';post.comments.forEach((c,idx)=>{const cnode=document.createElement('div');cnode.className='comment small';cnode.innerHTML=`<strong>${escapeHtml(c.user)}</strong> ${escapeHtml(c.text)}`;const rb=document.createElement('div');rb.className='reply-box';const ri=document.createElement('input');ri.placeholder='대댓글';ri.style.width='70%';const rbtn=document.createElement('button');rbtn.className='btn ghost';rbtn.textContent='↩';rbtn.onclick=()=>{addReply(post.id,idx,ri.value);ri.value=''};rb.append(ri,rbtn);cnode.appendChild(rb);if(c.replies)c.replies.forEach(r=>{const rn=document.createElement('div');rn.className='small';rn.style.marginLeft='20px';rn.innerHTML=`↳ <strong>${escapeHtml(r.user)}</strong> ${escapeHtml(r.text)}`;cnode.appendChild(rn)});cl.appendChild(cnode)});
  const commentBox=document.createElement('div');commentBox.className='comment-box';const ci=document.createElement('input');ci.placeholder='댓글 달기...';ci.style.width='70%';const cb=document.createElement('button');cb.className='btn ghost';cb.textContent='댓글';cb.onclick=()=>{addComment(post.id,ci.value);ci.value=''};commentBox.append(ci,cb);
  node.append(meta,body,actions,cl,commentBox);feed.appendChild(node);}}

function renderBest(){const best=document.getElementById('best');best.innerHTML='';const posts=storage('ps_posts')||[];posts.sort((a,b)=>(b.likes-b.dislikes)-(a.likes-a.dislikes));posts.slice(0,5).forEach(p=>{const d=document.createElement('div');d.className='best-item';d.textContent=`${p.title} (${p.likes}👍)`;best.appendChild(d)});}

renderFeed();renderBest();

// theme toggle
const btn=document.getElementById('theme-toggle');btn.onclick=()=>{document.body.classList.toggle('light');};
</script>
</body>
</html>
